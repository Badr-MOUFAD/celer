<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Lasso path computation on Finance/log1p dataset &#8212; celer 0.6.1dev documentation</title>
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/style.css" />
    <link rel="stylesheet" type="text/css" href="../_static/gallery.css" />
    <link rel="stylesheet" type="text/css" href="../_static/gallery-binder.css" />
    <link rel="stylesheet" type="text/css" href="../_static/gallery-dataframe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/gallery-rendered-html.css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js "></script>
<script type="text/javascript" src="../_static/js/jquery-fix.js "></script>
<script type="text/javascript" src="../_static/bootstrap-3.3.7/js/bootstrap.min.js "></script>
<script type="text/javascript" src="../_static/bootstrap-sphinx.js "></script>

  </head><body>

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../index.html">
          celer</a>
        <span class="navbar-text navbar-version pull-left"><b>0.6.1dev</b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="index.html">Examples</a></li>
                <li><a href="../api.html">API</a></li>
                <li><a href="https://github.com/mathurinm/celer">GitHub</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../index.html">Site <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul>
<li class="toctree-l1"><a class="reference internal" href="../api.html">API Documentation</a></li>
</ul>
</ul>
</li>
              
            
            
            
            
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  <div class="sphx-glr-download-link-note admonition note">
<p class="admonition-title">Note</p>
<p>Click <a class="reference internal" href="#sphx-glr-download-auto-examples-plot-finance-path-py"><span class="std std-ref">here</span></a>
to download the full example code</p>
</div>
<div class="sphx-glr-example-title section" id="lasso-path-computation-on-finance-log1p-dataset">
<span id="sphx-glr-auto-examples-plot-finance-path-py"></span><h1>Lasso path computation on Finance/log1p dataset<a class="headerlink" href="#lasso-path-computation-on-finance-log1p-dataset" title="Permalink to this headline">Â¶</a></h1>
<p>The example runs the Celer algorithm on the Finance dataset
which is a large sparse dataset.</p>
<p>Running time is not compared with the scikit-learn
implementation as it makes the example too long to run.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">time</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">libsvmdata</span> <span class="kn">import</span> <span class="n">fetch_libsvm</span>

<span class="kn">from</span> <span class="nn">celer</span> <span class="kn">import</span> <span class="n">celer_path</span>

<span class="nb">print</span><span class="p">(</span><span class="vm">__doc__</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;*** Warning: this example may take more than 5 minutes to run ***&quot;</span><span class="p">)</span>
<a href="http://docs.scipy.org/doc/scipy-0.17.0/reference/generated/scipy.sparse.html#scipy.sparse.csc_matrix" title="scipy.sparse.csc_matrix" class="sphx-glr-backref-module-scipy-sparse sphx-glr-backref-type-scipy-optimize-class"><span class="n">X</span></a><span class="p">,</span> <a href="http://docs.scipy.org/doc/numpy-1.9.1/reference/generated/numpy.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-np-class"><span class="n">y</span></a> <span class="o">=</span> <span class="n">fetch_libsvm</span><span class="p">(</span><span class="s1">&#39;finance&#39;</span><span class="p">)</span>
<a href="http://docs.scipy.org/doc/numpy-1.9.1/reference/generated/numpy.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-np-class"><span class="n">y</span></a> <span class="o">-=</span> <a href="http://docs.scipy.org/doc/numpy-1.9.1/reference/generated/numpy.html#numpy.mean" title="numpy.mean" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-np-function"><span class="n">np</span><span class="o">.</span><span class="n">mean</span></a><span class="p">(</span><a href="http://docs.scipy.org/doc/numpy-1.9.1/reference/generated/numpy.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-np-class"><span class="n">y</span></a><span class="p">)</span>
<span class="n">n_samples</span><span class="p">,</span> <span class="n">n_features</span> <span class="o">=</span> <a href="http://docs.scipy.org/doc/scipy-0.17.0/reference/generated/scipy.sparse.csc_matrix.html#scipy.sparse.csc_matrix.shape" title="scipy.sparse.csc_matrix.shape" class="sphx-glr-backref-module-scipy-sparse sphx-glr-backref-type-scipy-optimize-attribute"><span class="n">X</span><span class="o">.</span><span class="n">shape</span></a>
<span class="n">alpha_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><a href="http://docs.scipy.org/doc/scipy-0.17.0/reference/generated/scipy.sparse.csr_matrix.html#scipy.sparse.csr_matrix.dot" title="scipy.sparse.csr_matrix.dot" class="sphx-glr-backref-module-scipy-sparse sphx-glr-backref-type-scipy-optimize-method"><span class="n">X</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">dot</span></a><span class="p">(</span><a href="http://docs.scipy.org/doc/numpy-1.9.1/reference/generated/numpy.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-np-class"><span class="n">y</span></a><span class="p">)))</span> <span class="o">/</span> <span class="n">n_samples</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Dataset size: </span><span class="si">%d</span><span class="s2"> samples, </span><span class="si">%d</span><span class="s2"> features&quot;</span> <span class="o">%</span> <a href="http://docs.scipy.org/doc/scipy-0.17.0/reference/generated/scipy.sparse.csc_matrix.html#scipy.sparse.csc_matrix.shape" title="scipy.sparse.csc_matrix.shape" class="sphx-glr-backref-module-scipy-sparse sphx-glr-backref-type-scipy-optimize-attribute"><span class="n">X</span><span class="o">.</span><span class="n">shape</span></a><span class="p">)</span>

<span class="c1"># construct grid of regularization parameters alpha</span>
<span class="n">n_alphas</span> <span class="o">=</span> <span class="mi">11</span>
<a href="http://docs.scipy.org/doc/numpy-1.9.1/reference/generated/numpy.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-np-class"><span class="n">alphas</span></a> <span class="o">=</span> <span class="n">alpha_max</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">geomspace</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="n">n_alphas</span><span class="p">)</span>
</pre></div>
</div>
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>*** Warning: this example may take more than 5 minutes to run ***
Dataset: finance
Dataset size: 16087 samples, 1668737 features
</pre></div>
</div>
<p>Run Celer on a grid of regularization parameters, for various tolerances:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">tols</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1e-2</span><span class="p">,</span> <span class="mf">1e-4</span><span class="p">,</span> <span class="mf">1e-6</span><span class="p">]</span>
<a href="http://docs.scipy.org/doc/numpy-1.9.1/reference/generated/numpy.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-np-class"><span class="n">results</span></a> <span class="o">=</span> <a href="http://docs.scipy.org/doc/numpy-1.9.1/reference/generated/numpy.html#numpy.zeros" title="numpy.zeros" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-np-function"><span class="n">np</span><span class="o">.</span><span class="n">zeros</span></a><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">tols</span><span class="p">)])</span>
<a href="http://docs.scipy.org/doc/numpy-1.9.1/reference/generated/numpy.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-np-class"><span class="n">gaps</span></a> <span class="o">=</span> <a href="http://docs.scipy.org/doc/numpy-1.9.1/reference/generated/numpy.html#numpy.zeros" title="numpy.zeros" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-np-function"><span class="n">np</span><span class="o">.</span><span class="n">zeros</span></a><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">tols</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><a href="http://docs.scipy.org/doc/numpy-1.9.1/reference/generated/numpy.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-np-class"><span class="n">alphas</span></a><span class="p">)))</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Starting path computation...&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">tol_ix</span><span class="p">,</span> <span class="n">tol</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">tols</span><span class="p">):</span>
    <span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">celer_path</span><span class="p">(</span><a href="http://docs.scipy.org/doc/scipy-0.17.0/reference/generated/scipy.sparse.html#scipy.sparse.csc_matrix" title="scipy.sparse.csc_matrix" class="sphx-glr-backref-module-scipy-sparse sphx-glr-backref-type-scipy-optimize-class"><span class="n">X</span></a><span class="p">,</span> <a href="http://docs.scipy.org/doc/numpy-1.9.1/reference/generated/numpy.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-np-class"><span class="n">y</span></a><span class="p">,</span> <span class="s1">&#39;lasso&#39;</span><span class="p">,</span> <a href="http://docs.scipy.org/doc/numpy-1.9.1/reference/generated/numpy.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-np-class"><span class="n">alphas</span></a><span class="o">=</span><a href="http://docs.scipy.org/doc/numpy-1.9.1/reference/generated/numpy.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-np-class"><span class="n">alphas</span></a><span class="p">,</span>
                     <span class="n">tol</span><span class="o">=</span><span class="n">tol</span><span class="p">,</span> <span class="n">prune</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <a href="http://docs.scipy.org/doc/numpy-1.9.1/reference/generated/numpy.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-np-class"><span class="n">results</span></a><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="n">tol_ix</span><span class="p">]</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">t0</span>
    <a href="http://docs.scipy.org/doc/numpy-1.9.1/reference/generated/numpy.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-np-class"><span class="n">_</span></a><span class="p">,</span> <a href="http://docs.scipy.org/doc/numpy-1.9.1/reference/generated/numpy.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-np-class"><span class="n">coefs</span></a><span class="p">,</span> <a href="http://docs.scipy.org/doc/numpy-1.9.1/reference/generated/numpy.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-np-class"><span class="n">gaps</span></a><span class="p">[</span><span class="n">tol_ix</span><span class="p">]</span> <span class="o">=</span> <span class="n">res</span>


<span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="sa">r</span><span class="s2">&quot;\sc</span><span class="si">{Celer}</span><span class="s2">&quot;</span><span class="p">]</span>
<span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">)</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><a href="http://docs.scipy.org/doc/numpy-1.9.1/reference/generated/numpy.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-np-class"><span class="n">results</span><span class="o">.</span><span class="n">T</span></a><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Celer&quot;</span><span class="p">])</span>
<span class="n">df</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">tol</span><span class="p">)</span> <span class="k">for</span> <span class="n">tol</span> <span class="ow">in</span> <span class="n">tols</span><span class="p">]</span>
<span class="n">df</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">rot</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">figsize</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;stopping tolerance&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;path computation time (s)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">block</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<img alt="plot finance path" class="sphx-glr-single-img" src="../_images/sphx_glr_plot_finance_path_001.png" />
<p class="sphx-glr-script-out">Out:</p>
<div class="sphx-glr-script-out highlight-none notranslate"><div class="highlight"><pre><span></span>Starting path computation...
##########################
##### Computing alpha 1/11
##########################
Iter 0: primal 0.1998879584, gap -2.78e-17
Early exit, gap: -2.78e-17 &lt; 4.00e-03
##########################
##### Computing alpha 2/11
##########################
Iter 0: primal 0.1998879584, gap 8.46e-03, 1 feats in subpb (400 left)
Iter 1: primal 0.1996695929, gap 1.10e-05
Early exit, gap: 1.10e-05 &lt; 4.00e-03
##########################
##### Computing alpha 3/11
##########################
Iter 0: primal 0.1993226851, gap 8.66e-03, 1 feats in subpb (677 left)
Iter 1: primal 0.1991849058, gap 1.25e-02, 2 feats in subpb (677 left)
Iter 2: primal 0.1988140591, gap 2.51e-03
Early exit, gap: 2.51e-03 &lt; 4.00e-03
##########################
##### Computing alpha 4/11
##########################
Iter 0: primal 0.1974240538, gap 1.60e-02, 2 feats in subpb (1729 left)
Iter 1: primal 0.1967819954, gap 1.40e-02, 4 feats in subpb (1561 left)
Iter 2: primal 0.1956866003, gap 4.37e-03, 8 feats in subpb (576 left)
Iter 3: primal 0.1955621705, gap 1.53e-03
Early exit, gap: 1.53e-03 &lt; 4.00e-03
##########################
##### Computing alpha 5/11
##########################
Iter 0: primal 0.1921010081, gap 1.19e-02, 8 feats in subpb (2030 left)
Iter 1: primal 0.1911303017, gap 1.49e-02, 16 feats in subpb (2030 left)
Iter 2: primal 0.1894625859, gap 4.45e-03, 22 feats in subpb (919 left)
Iter 3: primal 0.1892191251, gap 1.11e-03
Early exit, gap: 1.11e-03 &lt; 4.00e-03
##########################
##### Computing alpha 6/11
##########################
Iter 0: primal 0.1826192526, gap 9.06e-03, 17 feats in subpb (2410 left)
Iter 1: primal 0.1796959793, gap 3.12e-03
Early exit, gap: 3.12e-03 &lt; 4.00e-03
##########################
##### Computing alpha 7/11
##########################
Iter 0: primal 0.1705243076, gap 1.12e-02, 14 feats in subpb (4061 left)
Iter 1: primal 0.1681273196, gap 9.86e-03, 26 feats in subpb (3715 left)
Iter 2: primal 0.1678406972, gap 1.80e-03
Early exit, gap: 1.80e-03 &lt; 4.00e-03
##########################
##### Computing alpha 8/11
##########################
Iter 0: primal 0.1574632890, gap 8.63e-03, 20 feats in subpb (4812 left)
Iter 1: primal 0.1556128718, gap 6.22e-03, 36 feats in subpb (3818 left)
Iter 2: primal 0.1553370834, gap 1.57e-03
Early exit, gap: 1.57e-03 &lt; 4.00e-03
##########################
##### Computing alpha 9/11
##########################
Iter 0: primal 0.1443973630, gap 6.71e-03, 27 feats in subpb (5669 left)
Iter 1: primal 0.1433480061, gap 1.94e-03
Early exit, gap: 1.94e-03 &lt; 4.00e-03
###########################
##### Computing alpha 10/11
###########################
Iter 0: primal 0.1332521170, gap 7.31e-03, 26 feats in subpb (8541 left)
Iter 1: primal 0.1323958846, gap 7.72e-03, 48 feats in subpb (8541 left)
Iter 2: primal 0.1322564257, gap 2.17e-03
Early exit, gap: 2.17e-03 &lt; 4.00e-03
###########################
##### Computing alpha 11/11
###########################
Iter 0: primal 0.1229681542, gap 7.26e-03, 33 feats in subpb (12083 left)
Iter 1: primal 0.1222889686, gap 6.82e-03, 64 feats in subpb (11584 left)
Iter 2: primal 0.1221840202, gap 1.98e-03
Early exit, gap: 1.98e-03 &lt; 4.00e-03
##########################
##### Computing alpha 1/11
##########################
Iter 0: primal 0.1998879584, gap -2.78e-17
Early exit, gap: -2.78e-17 &lt; 4.00e-05
##########################
##### Computing alpha 2/11
##########################
Iter 0: primal 0.1998879584, gap 8.46e-03, 1 feats in subpb (400 left)
Iter 1: primal 0.1996695929, gap 1.10e-05
Early exit, gap: 1.10e-05 &lt; 4.00e-05
##########################
##### Computing alpha 3/11
##########################
Iter 0: primal 0.1993226851, gap 8.66e-03, 1 feats in subpb (677 left)
Iter 1: primal 0.1991849058, gap 1.25e-02, 2 feats in subpb (677 left)
Iter 2: primal 0.1988140591, gap 2.51e-03, 4 feats in subpb (180 left)
Iter 3: primal 0.1986284824, gap 1.04e-04, 8 feats in subpb (14 left)
Iter 4: primal 0.1986107746, gap 2.94e-05
Early exit, gap: 2.94e-05 &lt; 4.00e-05
##########################
##### Computing alpha 4/11
##########################
Iter 0: primal 0.1966638340, gap 8.12e-03, 5 feats in subpb (1019 left)
Iter 1: primal 0.1956546189, gap 3.76e-03, 10 feats in subpb (503 left)
Iter 2: primal 0.1954863652, gap 1.53e-03, 20 feats in subpb (203 left)
Iter 3: primal 0.1953795672, gap 1.40e-04, 22 feats in subpb (45 left)
Iter 4: primal 0.1953641576, gap 3.44e-05
Early exit, gap: 3.44e-05 &lt; 4.00e-05
##########################
##### Computing alpha 5/11
##########################
Iter 0: primal 0.1911699828, gap 7.48e-03, 11 feats in subpb (1458 left)
Iter 1: primal 0.1892961682, gap 1.96e-03, 22 feats in subpb (443 left)
Iter 2: primal 0.1891952428, gap 3.95e-04, 30 feats in subpb (118 left)
Iter 3: primal 0.1891773503, gap 5.09e-05, 30 feats in subpb (43 left)
Iter 4: primal 0.1891751720, gap 1.25e-05
Early exit, gap: 1.25e-05 &lt; 4.00e-05
##########################
##### Computing alpha 6/11
##########################
Iter 0: primal 0.1822931274, gap 6.62e-03, 14 feats in subpb (1885 left)
Iter 1: primal 0.1797431460, gap 4.01e-03, 28 feats in subpb (1340 left)
Iter 2: primal 0.1795561178, gap 3.96e-04, 38 feats in subpb (169 left)
Iter 3: primal 0.1794942646, gap 1.64e-04, 36 feats in subpb (86 left)
Iter 4: primal 0.1794865169, gap 4.22e-05, 34 feats in subpb (52 left)
Iter 5: primal 0.1794860805, gap 1.08e-05
Early exit, gap: 1.08e-05 &lt; 4.00e-05
##########################
##### Computing alpha 7/11
##########################
Iter 0: primal 0.1695372426, gap 5.57e-03, 18 feats in subpb (2445 left)
Iter 1: primal 0.1677835384, gap 3.24e-03, 36 feats in subpb (1632 left)
Iter 2: primal 0.1676814426, gap 7.35e-04, 44 feats in subpb (500 left)
Iter 3: primal 0.1676487194, gap 1.26e-04, 46 feats in subpb (106 left)
Iter 4: primal 0.1676449935, gap 1.92e-05
Early exit, gap: 1.92e-05 &lt; 4.00e-05
##########################
##### Computing alpha 8/11
##########################
Iter 0: primal 0.1566598725, gap 4.87e-03, 22 feats in subpb (3187 left)
Iter 1: primal 0.1553658906, gap 5.13e-03, 42 feats in subpb (3173 left)
Iter 2: primal 0.1553079824, gap 1.43e-03, 54 feats in subpb (1345 left)
Iter 3: primal 0.1552687634, gap 4.04e-04, 52 feats in subpb (498 left)
Iter 4: primal 0.1552435186, gap 3.34e-05
Early exit, gap: 3.34e-05 &lt; 4.00e-05
##########################
##### Computing alpha 9/11
##########################
Iter 0: primal 0.1442177143, gap 4.34e-03, 25 feats in subpb (4194 left)
Iter 1: primal 0.1433492173, gap 1.49e-03, 46 feats in subpb (2036 left)
Iter 2: primal 0.1432762240, gap 4.04e-04, 54 feats in subpb (858 left)
Iter 3: primal 0.1432734131, gap 1.44e-04, 54 feats in subpb (382 left)
Iter 4: primal 0.1432711820, gap 2.97e-05
Early exit, gap: 2.97e-05 &lt; 4.00e-05
###########################
##### Computing alpha 10/11
###########################
Iter 0: primal 0.1329549998, gap 3.96e-03, 27 feats in subpb (5539 left)
Iter 1: primal 0.1323172231, gap 6.39e-03, 54 feats in subpb (5539 left)
Iter 2: primal 0.1322306096, gap 1.41e-03, 70 feats in subpb (2766 left)
Iter 3: primal 0.1321930623, gap 4.00e-04, 70 feats in subpb (1254 left)
Iter 4: primal 0.1321910569, gap 1.17e-04, 70 feats in subpb (537 left)
Iter 5: primal 0.1321900133, gap 9.93e-06
Early exit, gap: 9.93e-06 &lt; 4.00e-05
###########################
##### Computing alpha 11/11
###########################
Iter 0: primal 0.1227343087, gap 3.66e-03, 34 feats in subpb (7428 left)
Iter 1: primal 0.1222272835, gap 5.23e-03, 66 feats in subpb (7428 left)
Iter 2: primal 0.1221518019, gap 1.17e-03, 98 feats in subpb (3414 left)
Iter 3: primal 0.1221513299, gap 3.06e-04, 100 feats in subpb (1503 left)
Iter 4: primal 0.1221492415, gap 8.79e-05, 100 feats in subpb (711 left)
Iter 5: primal 0.1221484299, gap 2.44e-05
Early exit, gap: 2.44e-05 &lt; 4.00e-05
##########################
##### Computing alpha 1/11
##########################
Iter 0: primal 0.1998879584, gap -2.78e-17
Early exit, gap: -2.78e-17 &lt; 4.00e-07
##########################
##### Computing alpha 2/11
##########################
Iter 0: primal 0.1998879584, gap 8.46e-03, 1 feats in subpb (400 left)
Iter 1: primal 0.1996695929, gap 1.10e-05, 2 feats in subpb (2 left)
Iter 2: primal 0.1996653872, gap 2.41e-06, 2 feats in subpb (2 left)
Iter 3: primal 0.1996638191, gap 6.88e-07, 2 feats in subpb (2 left)
Iter 4: primal 0.1996631483, gap 2.78e-17
Early exit, gap: 2.78e-17 &lt; 4.00e-07
##########################
##### Computing alpha 3/11
##########################
Iter 0: primal 0.1993025719, gap 8.37e-03, 1 feats in subpb (655 left)
Iter 1: primal 0.1991579884, gap 1.29e-02, 2 feats in subpb (655 left)
Iter 2: primal 0.1987790779, gap 2.48e-03, 4 feats in subpb (179 left)
Iter 3: primal 0.1985977701, gap 9.97e-06, 8 feats in subpb (9 left)
Iter 4: primal 0.1985972553, gap 2.62e-06, 7 feats in subpb (7 left)
Iter 5: primal 0.1985972481, gap 6.27e-07, 6 feats in subpb (6 left)
Iter 6: primal 0.1985972479, gap 1.56e-07
Early exit, gap: 1.56e-07 &lt; 4.00e-07
##########################
##### Computing alpha 4/11
##########################
Iter 0: primal 0.1966468043, gap 8.00e-03, 4 feats in subpb (1013 left)
Iter 1: primal 0.1956274459, gap 4.39e-03, 8 feats in subpb (578 left)
Iter 2: primal 0.1955092862, gap 2.01e-03, 10 feats in subpb (268 left)
Iter 3: primal 0.1953564661, gap 1.92e-04, 16 feats in subpb (47 left)
Iter 4: primal 0.1953543090, gap 3.06e-05, 20 feats in subpb (23 left)
Iter 5: primal 0.1953540815, gap 7.33e-06, 15 feats in subpb (15 left)
Iter 6: primal 0.1953540745, gap 1.36e-06, 13 feats in subpb (13 left)
Iter 7: primal 0.1953540729, gap 2.57e-07
Early exit, gap: 2.57e-07 &lt; 4.00e-07
##########################
##### Computing alpha 5/11
##########################
Iter 0: primal 0.1911517315, gap 7.40e-03, 10 feats in subpb (1446 left)
Iter 1: primal 0.1892288560, gap 1.85e-03, 18 feats in subpb (424 left)
Iter 2: primal 0.1891982893, gap 4.30e-04, 32 feats in subpb (125 left)
Iter 3: primal 0.1891809272, gap 8.82e-05, 30 feats in subpb (56 left)
Iter 4: primal 0.1891782094, gap 2.51e-05, 30 feats in subpb (39 left)
Iter 5: primal 0.1891751683, gap 4.27e-06, 27 feats in subpb (27 left)
Iter 6: primal 0.1891751674, gap 6.94e-08
Early exit, gap: 6.94e-08 &lt; 4.00e-07
##########################
##### Computing alpha 6/11
##########################
Iter 0: primal 0.1822904942, gap 6.59e-03, 14 feats in subpb (1879 left)
Iter 1: primal 0.1796907509, gap 3.36e-03, 26 feats in subpb (1143 left)
Iter 2: primal 0.1795018665, gap 2.69e-04, 36 feats in subpb (120 left)
Iter 3: primal 0.1794880534, gap 8.05e-05, 34 feats in subpb (65 left)
Iter 4: primal 0.1794870919, gap 2.35e-05, 36 feats in subpb (48 left)
Iter 5: primal 0.1794851088, gap 6.74e-06, 31 feats in subpb (31 left)
Iter 6: primal 0.1794850955, gap 3.74e-07
Early exit, gap: 3.74e-07 &lt; 4.00e-07
##########################
##### Computing alpha 7/11
##########################
Iter 0: primal 0.1695288875, gap 5.55e-03, 18 feats in subpb (2437 left)
Iter 1: primal 0.1677649492, gap 2.68e-03, 36 feats in subpb (1443 left)
Iter 2: primal 0.1676554807, gap 7.30e-04, 46 feats in subpb (496 left)
Iter 3: primal 0.1676490150, gap 1.86e-04, 46 feats in subpb (142 left)
Iter 4: primal 0.1676467952, gap 4.73e-05, 44 feats in subpb (58 left)
Iter 5: primal 0.1676454327, gap 4.44e-06, 40 feats in subpb (40 left)
Iter 6: primal 0.1676445752, gap 1.13e-06, 33 feats in subpb (33 left)
Iter 7: primal 0.1676443497, gap 1.93e-07
Early exit, gap: 1.93e-07 &lt; 4.00e-07
##########################
##### Computing alpha 8/11
##########################
Iter 0: primal 0.1566517508, gap 4.83e-03, 22 feats in subpb (3170 left)
Iter 1: primal 0.1553627811, gap 4.10e-03, 42 feats in subpb (2794 left)
Iter 2: primal 0.1552669232, gap 4.66e-04, 54 feats in subpb (562 left)
Iter 3: primal 0.1552425208, gap 9.39e-05, 52 feats in subpb (139 left)
Iter 4: primal 0.1552380913, gap 2.78e-05, 50 feats in subpb (64 left)
Iter 5: primal 0.1552367320, gap 4.99e-06, 44 feats in subpb (44 left)
Iter 6: primal 0.1552357747, gap 1.50e-06, 36 feats in subpb (36 left)
Iter 7: primal 0.1552347368, gap 6.25e-05, 36 feats in subpb (36 left)
Iter 8: primal 0.1552346715, gap 1.36e-05, 36 feats in subpb (36 left)
Iter 9: primal 0.1552346485, gap 7.81e-07, 32 feats in subpb (32 left)
Iter 10: primal 0.1552345058, gap 3.33e-07
Early exit, gap: 3.33e-07 &lt; 4.00e-07
##########################
##### Computing alpha 9/11
##########################
Iter 0: primal 0.1442078094, gap 4.30e-03, 25 feats in subpb (4168 left)
Iter 1: primal 0.1433194443, gap 1.38e-03, 46 feats in subpb (1951 left)
Iter 2: primal 0.1432794418, gap 4.08e-04, 52 feats in subpb (861 left)
Iter 3: primal 0.1432697218, gap 8.07e-05, 52 feats in subpb (214 left)
Iter 4: primal 0.1432680386, gap 2.15e-05, 52 feats in subpb (92 left)
Iter 5: primal 0.1432672824, gap 6.22e-06, 52 feats in subpb (55 left)
Iter 6: primal 0.1432667348, gap 1.65e-06, 46 feats in subpb (46 left)
Iter 7: primal 0.1432666129, gap 3.48e-07
Early exit, gap: 3.48e-07 &lt; 4.00e-07
###########################
##### Computing alpha 10/11
###########################
Iter 0: primal 0.1329686451, gap 3.94e-03, 25 feats in subpb (5525 left)
Iter 1: primal 0.1322605836, gap 5.86e-03, 50 feats in subpb (5525 left)
Iter 2: primal 0.1321948371, gap 1.73e-03, 66 feats in subpb (3144 left)
Iter 3: primal 0.1321933711, gap 4.56e-04, 70 feats in subpb (1366 left)
Iter 4: primal 0.1321905789, gap 9.56e-05, 70 feats in subpb (473 left)
Iter 5: primal 0.1321898465, gap 2.80e-05, 72 feats in subpb (170 left)
Iter 6: primal 0.1321894332, gap 8.39e-06, 68 feats in subpb (104 left)
Iter 7: primal 0.1321893784, gap 2.45e-06, 68 feats in subpb (69 left)
Iter 8: primal 0.1321893633, gap 7.18e-07, 51 feats in subpb (51 left)
Iter 9: primal 0.1321893622, gap 2.12e-07
Early exit, gap: 2.12e-07 &lt; 4.00e-07
###########################
##### Computing alpha 11/11
###########################
Iter 0: primal 0.1227389914, gap 3.65e-03, 35 feats in subpb (7421 left)
Iter 1: primal 0.1222212689, gap 4.95e-03, 66 feats in subpb (7421 left)
Iter 2: primal 0.1221629691, gap 1.44e-03, 98 feats in subpb (3902 left)
Iter 3: primal 0.1221542130, gap 3.85e-04, 98 feats in subpb (1714 left)
Iter 4: primal 0.1221498355, gap 5.79e-05, 98 feats in subpb (514 left)
Iter 5: primal 0.1221484079, gap 1.71e-05, 100 feats in subpb (216 left)
Iter 6: primal 0.1221482204, gap 5.07e-06, 100 feats in subpb (119 left)
Iter 7: primal 0.1221481962, gap 9.43e-07, 80 feats in subpb (80 left)
Iter 8: primal 0.1221481847, gap 2.51e-07
Early exit, gap: 2.51e-07 &lt; 4.00e-07
</pre></div>
</div>
<p>Measure the influence of regularization on the sparsity of the solutions:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">constrained_layout</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><a href="http://docs.scipy.org/doc/numpy-1.9.1/reference/generated/numpy.html#numpy.arange" title="numpy.arange" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-np-function"><span class="n">np</span><span class="o">.</span><span class="n">arange</span></a><span class="p">(</span><span class="n">n_alphas</span><span class="p">),</span> <span class="p">(</span><a href="http://docs.scipy.org/doc/numpy-1.9.1/reference/generated/numpy.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-np-class"><span class="n">coefs</span></a> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Sparsity of solution along regularization path&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$||\hat w||_0$&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\lambda / \lambda_{\mathrm</span><span class="si">{max}</span><span class="s2">}$&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><a href="http://docs.scipy.org/doc/numpy-1.9.1/reference/generated/numpy.html#numpy.arange" title="numpy.arange" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-np-function"><span class="n">np</span><span class="o">.</span><span class="n">arange</span></a><span class="p">(</span><span class="n">n_alphas</span><span class="p">)[::</span><span class="mi">2</span><span class="p">])</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">x</span><span class="p">,</span> <a href="http://docs.scipy.org/doc/numpy-1.9.1/reference/generated/numpy.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-np-class"><span class="n">alphas</span></a><span class="p">[::</span><span class="mi">2</span><span class="p">]</span> <span class="o">/</span> <a href="http://docs.scipy.org/doc/numpy-1.9.1/reference/generated/numpy.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-np-class"><span class="n">alphas</span></a><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">block</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<img alt="Sparsity of solution along regularization path" class="sphx-glr-single-img" src="../_images/sphx_glr_plot_finance_path_002.png" />
<p>Check convergence guarantees: gap is inferior to tolerance</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><a href="http://docs.scipy.org/doc/numpy-1.9.1/reference/generated/numpy.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-np-class"><span class="n">gaps</span><span class="o">.</span><span class="n">T</span></a><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="sa">r</span><span class="s2">&quot;tol=</span><span class="si">%.0e</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">x</span><span class="p">,</span> <span class="n">tols</span><span class="p">))</span>
<span class="n">df</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">x</span><span class="p">,</span> <a href="http://docs.scipy.org/doc/numpy-1.9.1/reference/generated/numpy.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-np-class"><span class="n">alphas</span></a> <span class="o">/</span> <a href="http://docs.scipy.org/doc/numpy-1.9.1/reference/generated/numpy.html#numpy.ndarray" title="numpy.ndarray" class="sphx-glr-backref-module-numpy sphx-glr-backref-type-np-class"><span class="n">alphas</span></a><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">plot</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;duality gap reached&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\lambda / \lambda_{\mathrm</span><span class="si">{max}</span><span class="s2">}$&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">tols</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">block</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<img alt="plot finance path" class="sphx-glr-single-img" src="../_images/sphx_glr_plot_finance_path_003.png" />
<p class="sphx-glr-timing"><strong>Total running time of the script:</strong> ( 4 minutes  0.736 seconds)</p>
<div class="sphx-glr-footer class sphx-glr-footer-example docutils container" id="sphx-glr-download-auto-examples-plot-finance-path-py">
<div class="sphx-glr-download sphx-glr-download-python docutils container">
<p><a class="reference download internal" download="" href="../_downloads/1e2b507d59f5c81fd7116ff6c187df47/plot_finance_path.py"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Python</span> <span class="pre">source</span> <span class="pre">code:</span> <span class="pre">plot_finance_path.py</span></code></a></p>
</div>
<div class="sphx-glr-download sphx-glr-download-jupyter docutils container">
<p><a class="reference download internal" download="" href="../_downloads/81d5dd0c6075bc38425217155f0b6749/plot_finance_path.ipynb"><code class="xref download docutils literal notranslate"><span class="pre">Download</span> <span class="pre">Jupyter</span> <span class="pre">notebook:</span> <span class="pre">plot_finance_path.ipynb</span></code></a></p>
</div>
</div>
<p class="sphx-glr-signature"><a class="reference external" href="https://sphinx-gallery.github.io">Gallery generated by Sphinx-Gallery</a></p>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2018, Mathurin Massias.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 3.4.3.<br/>
    </p>
  </div>
</footer>
  </body>
</html>